<!DOCTYPE html>
<html>
<head>
    <title>Seal Murderer - Multiplayer & AI</title>
    <script src="https://unpkg.com"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; margin: 0; overflow: hidden; }
        canvas { background: #333; border: 4px solid #555; image-rendering: pixelated; display: block; margin: 0 auto; }
        #menu { padding: 20px; }
        input { padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; cursor: pointer; background: #00ccff; border: none; color: black; font-weight: bold; }
    </style>
</head>
<body>
    <div id="menu">
        <h1>SEAL LOBBY</h1>
        <p>Your ID: <span id="my-id">...</span></p>
        <input type="text" id="friend-id" placeholder="Paste Friend ID here">
        <button onclick="connectToFriend()">JOIN FRIEND</button>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 800; canvas.height = 500;

    // --- 1. PLAYER & AI DATA ---
    let player = { x: 100, y: 100, color: 'cyan', role: 'Bystander' };
    let friend = { x: -100, y: -100, color: 'lime' }; // Hidden until connected
    
    let bots = [
        { x: 300, y: 200, color: 'yellow', alive: true, vx: 1, vy: 1 },
        { x: 500, y: 400, color: 'pink', alive: true, vx: -1, vy: 0.5 }
    ];

    // --- 2. MULTIPLAYER (PeerJS) ---
    const peer = new Peer();
    let connection;

    peer.on('open', (id) => document.getElementById('my-id').innerText = id);

    function connectToFriend() {
        const id = document.getElementById('friend-id').value;
        connection = peer.connect(id);
        setupConn();
    }

    peer.on('connection', (conn) => {
        connection = conn;
        setupConn();
    });

    function setupConn() {
        connection.on('data', (data) => {
            friend.x = data.x; friend.y = data.y; // Sync friend's position
        });
        document.getElementById('menu').style.display = 'none';
    }

    // --- 3. INPUTS ---
    let keys = {};
    window.onkeydown = (e) => keys[e.code] = true;
    window.onkeyup = (e) => keys[e.code] = false;

    // --- 4. GAME LOOP ---
    function loop() {
        // Move Local Player
        if (keys['ArrowUp']) player.y -= 3;
        if (keys['ArrowDown']) player.y += 3;
        if (keys['ArrowLeft']) player.x -= 3;
        if (keys['ArrowRight']) player.x += 3;

        // Send Data to Friend
        if (connection && connection.open) {
            connection.send({ x: player.x, y: player.y });
        }

        // --- 5. AI WANDERING LOGIC ---
        bots.forEach(bot => {
            if (bot.alive) {
                bot.x += bot.vx;
                bot.y += bot.vy;
                // Bounce off walls
                if (bot.x < 0 || bot.x > canvas.width - 20) bot.vx *= -1;
                if (bot.y < 0 || bot.y > canvas.height - 20) bot.vy *= -1;
                // Randomly change direction
                if (Math.random() < 0.01) {
                    bot.vx = (Math.random() - 0.5) * 4;
                    bot.vy = (Math.random() - 0.5) * 4;
                }
            }
        });

        draw();
        requestAnimationFrame(loop);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Draw AI Bots
        bots.forEach(b => {
            ctx.fillStyle = b.color;
            ctx.fillRect(b.x, b.y, 25, 25);
        });
        // Draw Friend
        ctx.fillStyle = friend.color;
        ctx.fillRect(friend.x, friend.y, 25, 25);
        // Draw Player
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, 25, 25);
    }

    loop();
</script>
</body>
</html>
